---
title: "Analyse des avantages de l'utilisation d'outils chez Enhydra lutris (L., 1758)"
author: "Maëra Minique, Arthur Baurain, Quentin Dewulf, Rohan Boulaki"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
bibliography: references.bib
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but (que vous remanierez éventuellement en fonction des modèles que vous ajouterez plus tard). Vous pouvez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

L'étude réalisée par Chris Law et al. publiée le 5 avril 2024 est analysée dans cette recherche. Les auteurs y mènent une étude sur environ 196 loutres de mer du sud (*Enhydra lutris* (L., 1758)) équipées d'émetteurs radio.

Selon les auteurs, l'utilisation d'outils apporte un avantage dans le maintient de la santé dentaire ainsi que dans l'atténuation du compromis entre l'accès aux proies, la santé dentaire et l'aport calorique. De plus, cette technique donne accès à des proies plus dures et plus grandes. Ce qui est essentiel dans des lieux où les proies sont rares [@law2024].

Il est nécessaire d'apporter des preuves supplémentaires à cette étude afin de confirmer les différents résultats et les différentes conclusions qui ont été fournies.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets du premier module de SDD II. -->

Les données utilisées sont les mêmes mesures réalisées sur *Enhydra lutris* (L., 1758)) de la publication , @law2024. Les analyses sont réalisées dans `r R.version.string` et plus précisément en utilisant la [SciViews Box 2025](https://www.sciviews.org/svbox/) dans [Saturn Cloud](https://saturncloud.io).

## Analyses

```{r setup, include=FALSE}
# Ceci est nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))

# Configure Knitr to use AGG as graphic device
knitr::opts_chunk$set(dev = "ragg_png")

# Configuration de l'environnement
SciViews::R("model", "infer")
```

<!--% Importez les données que vous aurez préalablement nettoyées, remaniées et labélisées dans le script R nommé `R/import.R`. -->

```{r import}
# Lecture des données
otters_tool <- read("data/otters_tool.rds")
tabularise$headtail(otters_tool)
skimr::skim(otters_tool)
naniar::vis_miss(otters_tool)
```

### Description des données

<!--% Chaque étudiant réalise et interprète un graphique pertinent en lien avec le but fixé et les modèles qui seront réalisés. Graphique et interprétation de l'étudiant #1 ci-dessous. -->

```{r chart1}
chart(otters_tool, ~ dietT | area) +
  geom_bar() +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```

Ce graphique a pour but de déterminer les occurences des différents types de proies consommées dans chaque zone étudiée.

Cela pourra potentiellement permettre par la suite d'interpréter des observations telles que le pourcentage d'utilisation d'outils dans les différentes zones, la masse ou la taille des individus de chaque zone, ...

on voit ici clairement que dans certaines zones (comme ElkhornSlough) la diversité des types de proies consommées est faible tandis que dans d'autres zones (comme Monterey et BigSur) le type de proie consommée est beaucoup plus diversifié et homogène.

PiedrasBlancas et SLO sont également plus généraux dans les types de proies consommées mais on observe malgré tout des préférences pour certaines espèces comme le crabe par exemple.

<!--% Graphique et interprétation de l'étudiant #2 ci-dessous. -->

```{r chart2}
ggplot(data = otters_tool, aes(x = length, y = mass, color = dietT)) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x) +
  labs(
    x = "Longueur du corps de la loutre [cm]",
    y = "Masse du corps de la loutre [kg]"
  ) +
  theme_bw() +
  theme( 
    panel.background = element_rect(fill = "aliceblue"),
    axis.title.x = element_text(color = "darkred", size = 14, face = "bold"),
    axis.title.y = element_text(color = "darkblue", size = 14, face = "bold")
  ) 

```

... interprétation #2...

<!--% Graphique et interprétation de l'étudiant #3 ci-dessous. -->

```{r chart3}

give_n <- function(x)
  c(y = max(x) * 1.1, label = length(x)) 

chart(otters_tool, lg_Tool ~ prey %fill=% prey) + geom_boxplot() + 
  stat_summary(fun.data = give_n, geom = "text", hjust = 0.5)

```

Ce graphique illustre la fréquence d’utilisation d’outils par les loutres en fonction de leur type de proie préféré.

On observe clairement une utilisation marquée des outils lorsque la proie principale est l’escargot, qui se distingue nettement des autres catégories. En revanche, les loutres recourent rarement aux outils pour accéder aux ormeaux, palourdes, crabes, moules, et encore moins aux oursins.

On peut expliquer cette différence par la facilité à ouvrir ces espèces, contrairement à l'escargot qui nécessite une effort spécifique.

Le facteur « autre » n’a pas été interprété ici, car il ne comporte que deux observations, ce qui ne permet pas d’en tirer des conclusions fiables.

<!--% Graphique et interprétation de l'étudiant #4 ci-dessous. -->

```{r chart4}

give_n2 <- function(x)
  c(y = max(x) * 1.1, label = length(x)) 

chart(data = otters_tool, lg_Tool ~ ageclass %fill=% sex) +
  geom_boxplot() +
  stat_summary(fun.data = give_n2, geom = "text", position = position_dodge(width = 0.75))
```

Ce graphique illustre le log de la fréquence d’utilisation d’outils par les loutres en fonction de leur classe d'age.

Nous constatons que l'usage d'outils est plus élevée chez les adultes agés, ceci pourrait démontrer que c'est une capacité acquise et non-innée.

Les femelles ont plus tendance à utiliser des outils que les mâles, ceci pourrait être dû à un dimorphisme sexuel où les femelles auraient moins de force que les mâles.

Nous constatons quelques valeurs extrêmes dans les 3 classes d'ages.

### Modélisation

<!--% Chaque modèle doit être décrit à l'aide d'un graphique et d'un tableau résumant le modèle. Les équations paramétrées de tous les modèles doivent être également présentes. L'analyse des résidus sera réalisée et interprétée pour chaque modèle. -->

#### Régression linéaire 1

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

```{r regression1}
otters_lm1 <- lm(data = otters_tool, tool_use ~ mussel_percent + snail_percent + 0)
# résumé du modèle
tabularise(summary_(otters_lm1))
#équation paramétrée
eq_(otters_lm1)
#graphiques des résidus
chart$residuals(otters_lm1)
# graphique du modèle
library(rgl)
knitr::knit_hooks$set(webgl = hook_webgl)
car::scatter3d(data = otters_tool, tool_use ~ mussel_percent + snail_percent,
  fit = "linear", residuals = TRUE, bg = "white", axis.scales = TRUE,
  grid = TRUE, ellipsoid = FALSE)
rgl::rglwidget(width = 800, height = 800)
```

Nous voyons ici que notre modèle linéaire est globalement significatif au seuil alpha de 5%. De plus, l'effet du pourcentage de moules consommées ainsi que celui des escargots consommés sont significativement différents de 0 au seuil alpha de 5%. R^2^ ajusté est plutôt correct avec une valeur de 0.8551.

Concernant l'analyse des résidus :

-   L'étendue des résidus est égale à celle des valeurs prédites (A)

-   La linéarité est respectée avec un léger décalge sur le centre des valeurs prédites peut-être dû à un manque d'observations sur cette partie du graphique par rapport aux extrémités (A).

-   Les rédidus ont une distribution qui ne diffère pas trop de la normale avec malgré tout une asymétrie sur les valeurs faibles et fortes (B).

-   Une hétéroscédasticité est possible, nous observons des valeurs resserrées à gauche, des valeurs intermédiaires plutôt dispersées et des valeurs qui se resserrent à nouveau sur la droite du graphique (C).

-   Nous observons plusieurs valeurs possédant une distance cook importante ainsi qu'un effet levier important. Certaines valeurs possèdent juste une distance de cook importante et d'autre ne possèdent qu'un effet levier important (D).

    Sur le graphique, nous pouvons observer que la distribution des observations n'est pas homogène. Beaucoup sont situées sur la gauche du graphique et sur la droite mais le centre de celui-ci est moins fourni en observation.

    De plus, nous observons que lorsque la fréquence d'utilisation d'outils augmente, le pourcentage de moules consommées est assez faible comparé au pourcentage d'escargot consommés qui lui, est clairement élevé pour une utilisation d'outils fréquente.

    Nous pourrions émettre l'hypothèse via ce graphique que les Loutres utilisent plus d'outils pour manger des escargots que pour manger des moules.

    Attention que notre modèle se base sur peu de données intermédiaires, c'est malheureusement le problème d'une expérience dans un milieu naturel. Il faut donc rester méfiant et objectif sur ce modèle.

#### Régression linéaire 2

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

```{r regression2}
otters_lm2 <- lm(data = otters_tool,Epreycalc ~ hardness + tool_use + age)

# Résumé du modèle
summary_(otters_lm2) |> tabularise()

# Équation paramétrée
eq_(otters_lm2)

# Graphiques des résidus
chart$residuals(otters_lm2)

```

Notre second modèle est significatif au seuil alpha de 5%.

Notre R² ajusté est moyen et explique 43 % de la variabilité de l'apport calorifique.

La dureté moyenne de la proie, la fréquence d'utilisation d'outils et l'âge sont tous significatifs au seuil alpha de 5%. Ceci explique significativement que les proies sont associées à un apport calorifique plus élevé. La fréquence d’utilisation d’outils influence également significativement l’apport calorifique. L’effet significatif de l’âge suggère un possible effet d’expérience ou d’apprentissage.

Concernant l'analyse des résidus :

-   La linéarité est globalement respectée, la courbe de tendance reste proche de l'axe horizontal zéro, bien que nous observons quelques valeurs prédites élevées (A).

-   Les résidus ont une distribution qui ne diffère pas trop de la normale avec une asymétrie sur les valeurs faibles et fortes (B).

-   Une hétéroscédasticité est probable. Nous observons que la majorité des données se situent sur la gauche et quelques valeurs dispersées sur la droite du graphique (C).

-   Nous observons quelques valeurs possédant un effet levier important. Cependant, ces points n'ont pas une distance de Cook importante (D).

Sur ces graphiques, nous pouvons observer également que la distribution des observations n'est pas homogène. Une grande concentration de données se trouve sur la gauche sur l'axe des valeurs prédites, alors que les données à droite sont beaucoup plus rares et dispersées.

De plus, l'élargissement du nuage de points au centre des graphiques (A et C) suggère que le modèle a plus de mal à prédire avec précision les valeurs moyennes que les valeurs faibles.

#### Modèle linéaire 1

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

```{r modele1}
otters_lm3 <- lm(data = otters_tool, mass ~ length * dietT, subset = length >= 80)
summary(otters_lm3) |> tabularise()

chart$residuals(otters_lm3)

otters_lm3bis <- lm(data = otters_tool, mass ~ length + dietT, subset = length >= 80)
anova(otters_lm3, otters_lm3bis) |> tabularise()
```

-   Nous vérifions dans un premier temps que la variable réponse soit bien une numérique et que la distribution soit bien (globalement) normale.

-   Nous testons ensuite notre modèle avec interactions ; nous constatons que de multiples variables apparaissent significativement différent de 0 au seuil alpha de 5% via les test t de Student.

-   Nous testons tout de même le modèle sans interactions, nous constatons que la valeur de R carré est très proche.

-   Nous réalisons une anova de comparaison des deux modèles (celui avec et sans interaction) pour vérifier le choix de modèle, nous observons que les deux modèles sont significativement différent l'un de l'autre au seuil alpha de 5% ce qui nous mène à choisir le modèle le plus complexe soit celui avec interactions (otters_lm3).

#### Modèle linéaire 2

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

```{r modele2}
# Modèle ANCOVA
otters_lm4 <- lm(data = otters_tool,total_prey~tool_use+ageclass+sex,subset=tool_use>3)

# Résumé du modèle
summary_(otters_lm4) |> tabularise()

# Équation paramétrée
eq_(otters_lm4)

# Graphiques des résidus
chart$residuals(otters_lm4)
```

-   Notre R² ajusté est moyen et explique 53 % de la variabilité du nombre de proies consommées.

-   Nous constatons qu'il n'y a pas de différences significatives du nombre de proies consommées entre mâles et femelles.

-   Les classes d'âge adultes et adultes âgés sont significatif ou presque au seuil alpha 5%, nous considérons donc une différence du nombre de proies consommées par classe d'age.

-   L'utilisation d'outils augmente le nombre de proies consommées pour les loutres qui utilisent des outils pour aumoins 3% de leur consommation de proies.

-   Les résidus ne varient pas trop des valeurs prédites.

-   Nous observons une non-normalité des résidus assez présentes.

-   Nous considérons que ce modèle valide le critère d'Homoscédasticité.

-   Nous constatons plusieurs valeurs extrêmes avec des effet de leviers élevés et des distances de Cook importante.

#### Modèle linéaire généralisé et/ou mixte 1

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r modele3}
# Modèle GLM
otters_glm1 <- glm(data = otters_tool, urchin_num ~ tool_use + length + ageclass, family = quasipoisson)
summary(otters_glm1) |> tabularise()

# Graphique des résidus
chart$residuals(otters_glm1)
```

-   Nous avons testé différentes formes de GLM, nous nous assurons ici de la non-normalité de la distribution dans le cas de la variable réponse "urchin_num" (quantité d'oursin consommés).

-   Nous choisissons initialement une famille de type "poisson" car la situation correspond à un dénombrement, une abondance. En regardant la dispersion observée (déviance résiduelle/degrés de libertés des résidus) on se rend compte qu'on est dans une situation de surdispersion, on opte alors pour un quasipoisson : on observe que le paramètre de dispersion ne change pas même si la surdispersion est moins marquée mais que les valeurs p des test Z ont diminué indiquant que les variables ont des valeurs qui sont d'avantage significativement différente de 0 au seuil alpha de 5%.

-   Les modèles GLM de famille quasi étant moins robuste, cette augmentation de la significativité peut n'être que dû à cette diminution de robustesse donc le modèle ne semble pas plus pertinent.

-   Étoffer le jeu de données pourrait être une piste d'avancement, peut-être cela permettrait-il d'avoir de meilleurs modèles GLM.

#### Modèle linéaire généralisé et/ou mixte 2

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r modele4}
# Modèle GLM

otters_glm2 <- glm(data = otters_tool, Epreycalc ~ hardness + tool_use + age, family = gaussian)

summary(otters_glm2) |> tabularise()


# Graphique des résidus

chart$residuals(otters_glm2) 
```

-   Nous choisissons une distribution log-normale car notre variable est strictement positive, continu et positif.

-   Nous avons testé différentes formes de GLM, nous nous assurons ici de la légère non-normalité de la distribution dans le cas de la variable réponse "Epreycalc" (nombre totale de calories consommées).

-   Toutes les variables sont significatives au seuil alpha 5%.

-   Nous observons une déviance des résidus correcte par rapport au parmamètre de dispersion.

-   Nous constatons une valeur extrêmes avec un effet levier important et une distance de cook importante aussi.

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les modèles les plus pertinents que vous retenez ? -->

...

## Références

<!--% N'indiquez rien ci-dessous. Quarto se chargera de rajouter vos références bibliographiques automatiquement. -->
