---
title: "___"
author: "Maëra Minique, Arthur Baurain, Quentin Dewulf, Rohan Boulaki"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
bibliography: references.bib
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but (que vous remanierez éventuellement en fonction des modèles que vous ajouterez plus tard). Vous pouvez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

... Introduction et but...

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets du premier module de SDD II. -->

...Matériel et méthodes...

## Analyses

```{r setup, include=FALSE}
# Ceci est nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))

# Configure Knitr to use AGG as graphic device
knitr::opts_chunk$set(dev = "ragg_png")

# Configuration de l'environnement
SciViews::R("model", "infer")
```

<!--% Importez les données que vous aurez préalablement nettoyées, remaniées et labélisées dans le script R nommé `R/import.R`. -->

```{r import}
# Lecture des données
load("data/cache/Data_temp/dat.Rdata")
dat -> otters_tool
source("R/import.R") #Exécute les remaniements de données fait dans import.R
# Tableau des premières et dernières lignes
tabularise$headtail(otters_tool)
skimr::skim(otters_tool)
naniar::vis_miss(otters_tool)
```

### Remaniements de données

```{r remaniement}
otters_tool$area <- as.factor(otters_tool$area)
otters_tool$prey <- as.factor(otters_tool$prey)
otters_tool$tooth_dam <- as.ordered(otters_tool$tooth_dam)
otters_tool <-smutate(otters_tool, total_prey = urchin_num+crab_num+mussel_num+clam_num+snail_num+abalone_num)
otters_tool <-smutate(otters_tool, urchin_percent = urchin_num/total_prey*100)
otters_tool <-smutate(otters_tool, abalone_percent = abalone_num/total_prey*100)
otters_tool <-smutate(otters_tool, mussel_percent = mussel_num/total_prey*100)
otters_tool <-smutate(otters_tool, clam_percent = clam_num/total_prey*100)
otters_tool <-smutate(otters_tool, snail_percent = snail_num/total_prey*100)
otters_tool <-smutate(otters_tool, crab_percent = crab_num/total_prey*100)
otters_tool <- labelise(otters_tool,
  label=list(
  total_prey="nombre totale de proies consommées",
  urchin_percent="pourcentage d'oursins consommés",
  abalone_percent="pourcentage d'ormeaux consomés",
  mussel_percent="pourcentage de moules consomées",
  clam_percent="pourcentage de palourdes consomées",
  snail_percent="pourcentage d'escargots consomés"),
units=list(
  total_prey=NA,
  urchin_percent="%",
  abalone_percent="%",
  mussel_percent="%",
  clam_percent="%",
  snail_percent="%"))
```

### Description des données

<!--% Chaque étudiant réalise et interprète un graphique pertinent en lien avec le but fixé et les modèles qui seront réalisés. Graphique et interprétation de l'étudiant #1 ci-dessous. -->

```{r chart1}
chart(otters_tool, ~ dietT | area) +
  geom_bar() +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

```

Ce graphique a pour but de déterminer les occurences des différents types de proies consommées dans chaque zone étudiée.

Cela pourra potentiellement permettre par la suite d'interpréter des observations telles que le pourcentage d'utilisation d'outils dans les différentes zones, la masse ou la taille des individus de chaque zone, ...

on voit ici clairement que dans certaines zones (comme ElkhornSlough) la diversité des types de proies consommées est faible tandis que dans d'autres zones (comme Monterey et BigSur) le type de proie consommée est beaucoup plus diversifié et homogène.

PiedrasBlancas et SLO sont également plus généraux dans les types de proies consommées mais on observe malgré tout des préférences pour certaines espèces comme le crabe par exemple.

<!--% Graphique et interprétation de l'étudiant #2 ci-dessous. -->

```{r chart2}
ggplot(data = otters_tool, aes(x = length, y = mass, color = dietT)) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x) +
  labs(
    x = "Longueur du corps de la loutre [cm]",
    y = "Masse du corps de la loutre [kg]"
  ) +
  theme_bw() +
  theme( 
    panel.background = element_rect(fill = "aliceblue"),
    axis.title.x = element_text(color = "darkred", size = 14, face = "bold"),
    axis.title.y = element_text(color = "darkblue", size = 14, face = "bold")
  ) 

```

... interprétation #2...

<!--% Graphique et interprétation de l'étudiant #3 ci-dessous. -->

```{r chart3}
# Matrice de corrélation :
  # otters_tool_clean <- otters_tool_num |> tidyr::drop_na()
  # correlation(otters_tool_clean) |> tabularise()
  # plot(otters_tool_clean)

# Fonction give_n pour les boxplots
give_n <- function(x)
  c(y = max(x) * 1.1, label = length(x)) 

#3 Utilisation d'outils par rapport aux proies consommées/régime alimentaire

chart(otters_tool, lg_Tool ~ prey %fill=% prey) + geom_boxplot() + 
  stat_summary(fun.data = give_n, geom = "text", hjust = 0.5)

```

\(1\) Les résultats montrent que les femelles utilisent les outils plus fréquemment que les mâles.

Cette différence suggère l’existence d’un dimorphisme sexuel qui induit un comportement d’utilisation d’outils différent.

<!--% Graphique et interprétation de l'étudiant #4 ci-dessous. -->

```{r chart4}
otters_tool%>.%
  sfilter(.,mussel_percent<15)%>.%
  chart(.,~ mussel_percent %col=% tooth_dam)+
  geom_histogram()


```

... interprétation #4...

### Modélisation

<!--% Chaque modèle doit être décrit à l'aide d'un graphique et d'un tableau résumant le modèle. Les équations paramétrées de tous les modèles doivent être également présentes. L'analyse des résidus sera réalisée et interprétée pour chaque modèle. -->

#### Régression linéaire 1

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

```{r regression1}
otters_lm1 <- lm(data = otters_tool, tool_use ~ mussel_percent + snail_percent + 0)
# résumé du modèle
tabularise(summary_(otters_lm1))
#équation paramétrée
eq_(otters_lm1)
#graphiques des résidus
chart$residuals(otters_lm1)
# graphique du modèle
library(rgl)
knitr::knit_hooks$set(webgl = hook_webgl)
car::scatter3d(data = otters_tool, tool_use ~ mussel_percent + snail_percent,
  fit = "linear", residuals = TRUE, bg = "white", axis.scales = TRUE,
  grid = TRUE, ellipsoid = FALSE)
rgl::rglwidget(width = 800, height = 800)
```

on voit ici que notre modèle linéaire est globalement significatif au seuil alpha de 5%. De plus, l'effet du poucentage de moules consommées ainsi que celui des escargots consommés sont significativement différents de 0 au seuil alpha de 5%. R^2^ ajusté est plutôt correct avec une valeur de 0.8551.

Concernant l'analyse des résidus :

-   L'étendue des résidus est égale à celle des valeurs prédites (A)

-   La linéarité est respectée avec un léger décalge sur le centre des valeurs prédites peut-être dû à un manque d'observations sur cette partie du graphique par rapport aux extrémités (A).

-   Les rédidus ont une distribution qui ne diffère pas trop de la normale avec malgré tout une asymétrie sur les valeurs faibles et fortes (B).

-   Une hétéroscédasticité est possible, on observe des valeurs resserrées à gauche, des valeurs intermédiaires plutôt dispersées et des valeurs qui se resserrent à nouveau sur la droite du graphique (C).

-   On observe plusieurs valeurs possédant une distance cook importante ainsi qu'un effet levier important. Certaines valeurs possèdent juste une distance de cook importante et d'autre ne possèdent qu'un effet levier important (D).

    Sur le graphique, on peut observer que la distribution des observations n'est pas homogène. Beaucoup sont situées sur la gauche du graphique et sur la droite mais le centre de celui-ci est moins fourni en observation.

    De plus, on observe que lorsque la fréquence d'utilisation d'outils augmente, le pourcentage de moules consommées est assez faible comparé au pourcentage d'escargot consommés qui lui, est clairement élevé pour une utilisation d'outils fréquente.

    On pourrait émettre l'hypothèse via ce graphique que les Loutres utilisent plus d'outils pour manger des escargots que pour manger des moules.

    Attention que notre modèle se base sur peu de données intermédiaires, c'est malheureusement le problème d'une expérience dans un milieu naturel. Il faut donc rester méfiant et objectif sur ce modèle.

#### Régression linéaire 2

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

```{r regression2}
# Régression polynomiale
otters_lm2 <- lm(data = otters_tool, mass ~ Epreycalc + I(Epreycalc^2) + I(Epreycalc^3) + 0)

# Résumé du modèle
summary_(otters_lm2) |> tabularise()

# Équation paramétrée
eq_(otters_lm2)

# Graphique du modèle
chart(otters_lm2)

# Graphiques des résidus
chart$residuals(otters_lm2)
```

#### Modèle linéaire 1

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

```{r modele1}
otters_lm3 <- lm(data = otters_tool, mass ~ length * dietT, subset = length >= 80)
summary(otters_lm3) |> tabularise()
```

#### Modèle linéaire 2

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

```{r modele2}
# Modèle ANCOVA
otters_lm4 <- lm(data = otters_tool, tool_use ~ hardness * prey + 0)

# Résumé du modèle
summary_(otters_lm4) |> tabularise()

# Équation paramétrée
eq_(otters_lm4)

# Graphiques des résidus
chart$residuals(otters_lm4)
```

#### Modèle linéaire généralisé et/ou mixte 1

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r modele3}

```

#### Modèle linéaire généralisé et/ou mixte 2

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r modele4}

```

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les modèles les plus pertinents que vous retenez ? -->

...vos conclusions ici...

## Références

<!--% N'indiquez rien ci-dessous. Quarto se chargera de rajouter vos références bibliographiques automatiquement. -->
